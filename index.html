<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø§Ù…ØªØ²Ø§Ø¬ Ø¢ÛŒØª Ø§Ù„Ú©Ø±Ø³ÛŒ</title>
<style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Naskh+Arabic&display=swap');

    /* --- Screen Styles --- */
    body {
        font-family: 'Noto Naskh Arabic', serif; /* Default until upload or fetch */
        background: linear-gradient(to bottom right, #f8fafd, #e0ecf8);
        margin: 0;
        padding: 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
        color: #222;
    }

    .container {
        width: 100%;
        max-width: 800px;
        background: #ffffff;
        padding: 20px;
        border-radius: 16px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
    }

    h1 { font-size: 1.8em; margin-bottom: 20px; text-align: center; }

    /* File Input Styling */
    .file-upload-wrapper {
        margin-bottom: 20px;
        padding: 15px;
        border: 2px dashed #007bff;
        border-radius: 8px;
        text-align: center;
        background: #f0f7ff;
    }
    
    .file-upload-wrapper label {
        display: block;
        margin-bottom: 10px;
        font-weight: bold;
        color: #007bff;
    }

    /* Separator Style */
    .separator {
        margin: 10px 0;
        color: #666;
        font-weight: bold;
    }

    input[type="text"], input[type="number"], select {
        font-size: 1.1em;
        width: 100%;
        padding: 14px;
        border: 2px solid #ccc;
        border-radius: 8px;
        margin-bottom: 15px;
        box-sizing: border-box;
        font-family: inherit; /* Use uploaded/fetched font */
    }

    button {
        width: 100%;
        padding: 14px;
        font-size: 1.1em;
        background: #007bff;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        margin-bottom: 10px;
        font-family: 'Noto Naskh Arabic', serif; /* Keep buttons readable */
    }
    button:hover { background: #0056b3; }

    /* Specific style for the Fetch button */
    #loadDefaultFontBtn {
        background: #28a745; /* Green to distinguish it */
    }
    #loadDefaultFontBtn:hover { background: #218838; }

    .output-box {
        margin-top: 25px;
        background-color: #f9f9f9;
        border: 1px solid #ddd;
        padding: 20px;
        font-size: 1.3em;
        line-height: 2.2;
        border-radius: 12px;
        text-align: justify;
        font-family: inherit; /* Use uploaded/fetched font */
        color: black; 
    }

    .inserted {
        color: inherit;
        font-weight: normal;
    }

    /* Print Area (Hidden on Screen) */
    #printArea {
        display: none;
    }

    /* Print Options Wrapper */
    #printOptions {
        display: none;
        margin-top: 20px;
        border-top: 1px solid #eee;
        padding-top: 20px;
    }

    /* --- PRINT STYLES --- */
    @media print {
        @page {
            size: A4 portrait;
            margin: 0; 
        }

        body {
            margin: 0;
            padding: 0;
            background: white;
            color: black !important;
            -webkit-print-color-adjust: exact;
        }

        /* Hide Interface */
        .container, h1, input, button, #groupOptions, .file-upload-wrapper, #printOptions {
            display: none !important;
        }

        /* Show Print Area */
        #printArea {
            display: block !important;
            width: 210mm; /* Full A4 width */
            min-height: 297mm;
            box-sizing: border-box;
            padding: 15mm; 
            font-size: 17px !important; 
            font-family: inherit; 
        }

        .print-block {
            text-align: justify;
            text-justify: inter-word;
            line-height: 1.6; 
            border-bottom: 1px dashed #aaa;
            padding-bottom: 15px;
            margin-bottom: 15px;
        }
        
        .print-block:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .inserted {
            color: black !important;
            font-weight: normal !important; 
        }
    }
</style>
</head>
<body>

<div class="container">
    <h1>Ø§Ù…ØªØ²Ø§Ø¬ Ø¢ÛŒØª Ø§Ù„Ú©Ø±Ø³ÛŒ</h1>

    <div class="file-upload-wrapper">
        <label for="fontInput">ğŸ—› Ø§Ù¾Ù†Ø§ ÙÙˆÙ†Ù¹ Ø§Ù¾ Ù„ÙˆÚˆ Ú©Ø±ÛŒÚº (.ttf)</label>
        <input type="file" id="fontInput" accept=".ttf, .otf, .woff">
        
        <div class="separator">--- ÛŒØ§ ---</div>

        <button id="loadDefaultFontBtn">ğŸ—› ÚˆÛŒÙØ§Ù„Ù¹ ÙÙˆÙ†Ù¹ Ø§Ø³ØªØ¹Ù…Ø§Ù„ Ú©Ø±ÛŒÚº</button>
    </div>
    
    <input id="inputWord" type="text" placeholder="Ù…Ø«Ù„Ø§Ù‹: Ø³Ù„ÛŒÙ…">
    <button id="imtizaajButton">Ø§Ù…ØªØ²Ø§Ø¬ Ú©Ø±ÛŒÚº</button>
    
    <div id="groupOptions" style="display:none; margin-top:15px;">
        <label>Ú©ØªÙ†Û’ Ø­Ø±ÙˆÙ Ú©Ø§ Ù…Ø¬Ù…ÙˆØ¹Û Ø¨Ù†Ø§Ø¦ÛŒÚºØŸ</label>
        <select id="groupSize">
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
        </select>
        <button id="groupButton">Ù…Ø¬Ù…ÙˆØ¹Û Ø¨Ù†Ø§Ø¦ÛŒÚº</button>
    </div>

    <h2 style="margin-top:20px;">ğŸ”¹ Ù…Ø¬Ù…ÙˆØ¹Û (Ú¯Ø±ÙˆÙ¾Úˆ)</h2>
    <div id="groupedOutput" class="output-box"></div>
    
    <div id="printOptions">
        <label for="copyCount">ğŸ–¨ï¸ Ú©Ø§Ù¾ÛŒØ§Úº Ú©ÛŒ ØªØ¹Ø¯Ø§Ø¯ (Copies):</label>
        <input type="number" id="copyCount" value="6" min="1" max="50">
        <button id="printButton" style="background:#28a745;">ğŸ–¨ï¸ A4 PDF Ù…Ø­ÙÙˆØ¸ Ú©Ø±ÛŒÚº</button>
    </div>
</div>

<div id="printArea"></div>

<script>
    let blended = [];

    // Function to apply font style (Used by both Upload and Default button)
    function applyFontStyle(fontSource, isUrl) {
        const style = document.createElement('style');
        
        // If it's a URL (from repo), use it directly. If it's data (upload), use it directly.
        const src = isUrl ? `url('${fontSource}')` : `url('${fontSource}')`;

        style.innerHTML = `
            @font-face {
                font-family: 'UploadedFont';
                src: ${src};
            }
            body, .output-box, #printArea, input[type="text"], input[type="number"] {
                font-family: 'UploadedFont', 'Noto Naskh Arabic', serif !important;
            }
        `;
        document.head.appendChild(style);
    }

    // 0a. Fetch Default Font from Repo
    document.getElementById('loadDefaultFontBtn').addEventListener('click', function() {
        // This path must match your GitHub repo structure relative to index.html
        const fontPath = 'fonts/ayat_ul_kursi_font.ttf'; 
        applyFontStyle(fontPath, true);
        
        document.querySelector("h1").innerText = "Ø§Ù…ØªØ²Ø§Ø¬ Ø¢ÛŒØª Ø§Ù„Ú©Ø±Ø³ÛŒ (ÚˆÛŒÙØ§Ù„Ù¹ ÙÙˆÙ†Ù¹ Ø³ÛŒÙ¹ ÛÙˆ Ú¯ÛŒØ§)";
        this.innerText = "âœ“ ÚˆÛŒÙØ§Ù„Ù¹ ÙÙˆÙ†Ù¹ ÙØ¹Ø§Ù„ ÛÛ’";
        this.disabled = true; // Prevent multiple clicks
    });

    // 0b. Font Upload Logic
    document.getElementById('fontInput').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function(e) {
            const fontData = e.target.result;
            applyFontStyle(fontData, false);
            document.querySelector("h1").innerText = "Ø§Ù…ØªØ²Ø§Ø¬ Ø¢ÛŒØª Ø§Ù„Ú©Ø±Ø³ÛŒ (ÙÙˆÙ†Ù¹ Ø³ÛŒÙ¹ ÛÙˆ Ú¯ÛŒØ§)";
            
            // Reset the default button if it was clicked previously
            const defaultBtn = document.getElementById('loadDefaultFontBtn');
            defaultBtn.innerText = "ğŸ—› ÚˆÛŒÙØ§Ù„Ù¹ ÙÙˆÙ†Ù¹ Ø§Ø³ØªØ¹Ù…Ø§Ù„ Ú©Ø±ÛŒÚº";
            defaultBtn.disabled = false;
        };
        reader.readAsDataURL(file);
    });

    // 1. Blending Logic
    document.getElementById("imtizaajButton").addEventListener("click", function () {
        const input = document.getElementById("inputWord").value.replace(/\s+/g, '');
        const output = document.getElementById("groupedOutput");

        if (input.length === 0) {
            output.innerHTML = "<span style='color:red'>Ø¨Ø±Ø§Û Ú©Ø±Ù… Ú©ÙˆØ¦ÛŒ Ù„ÙØ¸ Ø¯Ø±Ø¬ Ú©Ø±ÛŒÚºÛ”</span>";
            return;
        }

        const baseText = "Ø§ Ù„ Ù„ Ù‡ Ù„ Ø§ Ø§ Ù„ Ù‡ Ø§ Ù„ Ø§ Ú¾ Ùˆ Ø§ Ù„ Ø­ ÛŒ Ø§ Ù„ Ù‚ ÙŠ Ùˆ Ù… Ù„ Ø§ Øª Ø§ Ø® Ø° Ù‡ Ø³ Ù† Øª Ùˆ Ù„ Ø§ Ù† Ùˆ Ù… Ù„ Ù‡ Ù… Ø§ Ù ÙŠ Ø§ Ù„ Ø³ Ù… Ùˆ Øª Ùˆ Ù… Ø§ Ù ÙŠ Ø§ Ù„ Ø§ Ø± Ø¶ Ù… Ù† Ø° Ø§ Ø§ Ù„ Ø° ÙŠ ÙŠ Ø´ Ù Ø¹ Ø¹ Ù† Ø¯ Ù‡ Ø§ Ù„ Ø§ Ø¨ Ø§ Ø° Ù† Ù‡ ÙŠ Ø¹ Ù„ Ù… Ù… Ø§ Ø¨ ÙŠ Ù† Ø§ ÙŠ Ø¯ ÙŠ Ù‡ Ù… Ùˆ Ù… Ø§ Ø® Ù„ Ù Ù‡ Ù… Ùˆ Ù„ Ø§ ÛŒ Ø­ ÙŠ Ø· Ùˆ Ù† Ø¨ Ø´ ÙŠ Ù… Ù† Ø¹ Ù„ Ù… Ù‡ Ø§ Ù„ Ø§ Ø¨ Ù… Ø§ Ø´ Ø§ Ø¡ Ùˆ Ø³ Ø¹ Ú© Ø± Ø³ ÛŒ Ù‡ Ø§ Ù„ Ø³ Ù… Ùˆ Øª Ùˆ Ø§ Ù„ Ø§ Ø± Ø¶ Ùˆ Ù„ Ø§ ÙŠ Ùˆ Ø¯ Ù‡ Ø­ Ù Ø¸ Ú¾ Ù… Ø§ Ùˆ Ù‡ Ùˆ Ø§ Ù„ Ø¹ Ù„ ÙŠ Ø§ Ù„ Ø¹ Ø¸ ÙŠ Ù…";
        const baseWords = baseText.split(" ");
        const inputLetters = input.split("");
        blended = [];

        for (let i = 0; i < baseWords.length; i++) {
            if (i === baseWords.length - 1) {
                blended.push(baseWords[i]);
            } else {
                const letter = inputLetters[i % inputLetters.length];
                blended.push(baseWords[i]);
                blended.push(`<span class="inserted">${letter}</span>`);
            }
        }
        
        document.getElementById("groupOptions").style.display = "block";
        output.innerHTML = "Ù†ÛŒÚ†Û’ Ø¨Ù¹Ù† Ø¯Ø¨Ø§Ø¦ÛŒÚº...";
        document.getElementById("printOptions").style.display = "none";
    });

    // 2. Grouping Logic
    document.getElementById("groupButton").addEventListener("click", function () {
        const groupSize = parseInt(document.getElementById("groupSize").value);
        const groupedOutput = document.getElementById("groupedOutput");

        let grouped = "";
        for (let i = 0; i < blended.length; i++) {
            grouped += blended[i];
            if ((i + 1) % groupSize === 0) {
                grouped += " ";
            }
        }
        
        grouped = grouped.trim();
        groupedOutput.innerHTML = grouped;
        document.getElementById("printOptions").style.display = "block";
    });

    // 3. Print Logic (Dynamic Copies)
    document.getElementById("printButton").addEventListener("click", function () {
        const content = document.getElementById("groupedOutput").innerHTML;
        const printArea = document.getElementById("printArea");
        const copies = parseInt(document.getElementById("copyCount").value) || 6; // Default to 6 if empty

        // Build the HTML structure based on user input
        let html = "";
        for(let i=0; i < copies; i++) {
            html += `<div class="print-block">${content}</div>`;
        }
        printArea.innerHTML = html;

        // Open print dialog immediately
        window.print();
    });

</script>
</body>
</html>
